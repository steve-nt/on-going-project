\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{geometry}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{fancyhdr}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{float}
\usepackage{amsmath}
\usepackage{enumitem}

\geometry{margin=1in}
\pagestyle{fancy}
\fancyhf{}
\rhead{Lab 3: Authentication Security}
\lhead{Person A \& Person B}
\rfoot{Page \thepage}

\lstset{basicstyle=\ttfamily\small,breaklines=true,frame=single,numbers=left}
\hypersetup{colorlinks=true,linkcolor=blue}

\title{\textbf{Lab 3: Authentication Security\\From Password Storage to FIDO2/WebAuthn}}
\author{Person A \& Person B\\Date: \today}

\begin{document}
\maketitle

\begin{abstract}
This report presents a comprehensive study of authentication security mechanisms. We implemented four password hashing algorithms (SHA-256, SHA-3, bcrypt, Argon2), three MFA methods (TOTP, HOTP, WebAuthn), and demonstrated various security attacks. Key findings: Argon2 provides best password cracking resistance, constant-time comparison mitigates timing attacks, and WebAuthn's origin binding prevents MITM relay attacks that compromise OTP-based MFA.
\end{abstract}

\newpage
\tableofcontents
\newpage

\section{Introduction}
Authentication is fundamental to modern security systems. This lab explores the complete spectrum from secure password storage to multi-factor authentication.

\subsection{Objectives}
\begin{itemize}
\item Implement and compare four password hashing algorithms
\item Build secure authentication API with HMAC integrity
\item Implement TOTP, HOTP, and FIDO2/WebAuthn
\item Demonstrate password cracking, timing attacks, MITM relay
\item Analyze mitigation effectiveness
\end{itemize}

\section{Background}

\subsection{Password Hashing}
Good password hash functions must be: one-way, deterministic, slow, have avalanche effect, and be collision-resistant.

\subsubsection{Salt and Pepper}
\textbf{Salt}: Random value unique to each password\\
\textbf{Pepper}: System-wide secret

Mathematical representation: $hash = H^n(password || salt || pepper)$

\subsection{Multi-Factor Authentication}

\textbf{TOTP}: $TOTP = Truncate(HMAC-SHA1(K, \lfloor \frac{T - T_0}{X} \rfloor))$

\textbf{HOTP}: $HOTP = Truncate(HMAC-SHA1(K, C))$

\textbf{WebAuthn}: Public key cryptography with origin binding

\section{Implementation}

\subsection{Password Hashing}

\begin{lstlisting}[language=Python]
def hash_sha256(password, salt, rounds=100):
    hash_input = password.encode() + salt + PEPPER
    for _ in range(rounds):
        hash_input = hashlib.sha256(hash_input).digest()
    return hash_input

def hash_argon2(password):
    ph = Argon2PasswordHasher(time_cost=1, memory_cost=8192)
    return ph.hash(password + PEPPER.decode()).encode()
\end{lstlisting}

\subsection{Constant-Time Comparison}

\begin{lstlisting}[language=Python]
import hmac
result = hmac.compare_digest(hash1, hash2)
\end{lstlisting}

\subsection{MFA Implementation}

\begin{lstlisting}[language=Python]
# TOTP
def verify_totp(secret, token, time_window=1):
    totp = pyotp.TOTP(secret)
    return totp.verify(token, valid_window=time_window)

# WebAuthn
class WebAuthnManager:
    def __init__(self, rp_id="localhost"):
        self.rp = PublicKeyCredentialRpEntity(name="App", id=rp_id)
        self.server = Fido2Server(self.rp)
\end{lstlisting}

\section{Experimental Setup}

\subsection{Test Environment}
\begin{tabular}{ll}
\toprule
OS & Linux \\
Python & 3.13.7 \\
Database & SQLite3 \\
\bottomrule
\end{tabular}

\subsection{Test Datasets}
\textbf{Dictionary}: 30 common passwords\\
\textbf{Brute-force}: Lowercase + digits, length 1-4

\section{Results and Analysis}

\subsection{Password Cracking Performance}

\begin{table}[H]
\centering
\begin{tabular}{lrrr}
\toprule
Algorithm & Attempts/sec & Time (password) & Security \\
\midrule
SHA-256 (100 rounds) & $\sim$11,000 & 0.0001s & Low \\
SHA-3 (100 rounds) & $\sim$10,000 & 0.0001s & Low \\
bcrypt (cost 8) & $\sim$10 & 0.1s & Medium \\
Argon2 (default) & $\sim$5 & 0.2s & High \\
\bottomrule
\end{tabular}
\caption{Password Cracking Performance}
\end{table}

\textbf{Key Findings}: SHA-256/SHA-3 too fast; bcrypt good balance; Argon2 best (memory-hard, GPU-resistant).

\subsection{Salt and Pepper Impact}

Same password with different salts produces completely different hashes, preventing:
\begin{itemize}
\item Rainbow table attacks
\item User correlation
\item Parallel cracking
\end{itemize}

\subsection{Timing Attack Results}

\begin{table}[H]
\centering
\begin{tabular}{lcc}
\toprule
Test & Naive (seconds) & Constant-time \\
\midrule
Test 1 & $1.40 \times 10^{-7}$ & $2.03 \times 10^{-7}$ \\
Test 2 & $1.45 \times 10^{-7}$ & $2.01 \times 10^{-7}$ \\
Test 3 & $1.36 \times 10^{-7}$ & $1.95 \times 10^{-7}$ \\
\bottomrule
\end{tabular}
\caption{Timing Attack Measurements}
\end{table}

Constant-time comparison eliminates timing leakage at 43\% performance cost (acceptable).

\subsection{MFA Comparison}

\begin{table}[H]
\centering
\small
\begin{tabularx}{\textwidth}{lXXX}
\toprule
Property & HOTP & TOTP & WebAuthn \\
\midrule
Basis & Counter & Time & Public Key \\
Phishing Resistance & No & No & Yes \\
MITM Relay & Vulnerable & Vulnerable & Protected \\
User Experience & Button & Auto-refresh & Touch \\
Standards & RFC 4226 & RFC 6238 & W3C \\
\bottomrule
\end{tabularx}
\caption{MFA Comparison}
\end{table}

\subsection{MITM Relay Attack}

\textbf{TOTP Relay (Successful Attack)}:
\begin{enumerate}
\item User visits evil-site.com (MITM proxy)
\item User enters credentials + OTP: 123456
\item MITM captures and relays to real-site.com
\item Relay latency: 50ms (well within 30s window)
\item Real server accepts: ATTACK SUCCESSFUL
\end{enumerate}

\textbf{Why it works}: TOTP is just a number, no origin binding, valid for 30s.

\textbf{WebAuthn Protection (Attack Blocked)}:
\begin{enumerate}
\item User visits evil-site.com
\item Browser creates assertion with origin: evil-site.com
\item MITM forwards to real-site.com
\item Server checks: origin mismatch
\item ATTACK BLOCKED
\end{enumerate}

\textbf{Why WebAuthn prevents relay}: Cryptographic signature includes origin; server verifies origin matches RP-ID; browser enforces origin.

\begin{table}[H]
\centering
\begin{tabular}{lcc}
\toprule
Request Type & Latency (ms) & Success Rate \\
\midrule
/register & 34.2 & 100\% \\
/login & 28.5 & 100\% \\
/mfa/verify (TOTP) & 25.3 & 100\% \\
Average & 30.1 & 100\% \\
\bottomrule
\end{tabular}
\caption{MITM Relay Performance}
\end{table}

\textbf{Key Insight}: Relay latency (30ms) is negligible vs TOTP window (30,000ms), making relay highly effective.

\section{Security Analysis}

\subsection{Vulnerabilities Identified}
\begin{enumerate}
\item \textbf{SHA-256 for passwords}: Too fast, enables rapid brute-force
\item \textbf{Timing leaks}: Naive comparison reveals information
\item \textbf{TOTP relay}: No origin binding, OTP portable
\item \textbf{No rate limiting}: Unlimited attempts possible
\end{enumerate}

\subsection{Mitigations Implemented}
\begin{enumerate}
\item Strong hashing (Argon2/bcrypt)
\item Salt + Pepper
\item HMAC protection
\item Constant-time comparison
\item WebAuthn origin binding
\end{enumerate}

\section{Recommendations}

\subsection{For Developers}
\begin{enumerate}
\item Use Argon2 or bcrypt, never SHA-256 alone
\item Generate unique salts (32+ bytes)
\item Add system pepper
\item Use constant-time comparison
\item Implement rate limiting
\item Prefer WebAuthn over TOTP
\item Use HMAC for integrity
\end{enumerate}

\subsection{For System Administrators}
\begin{enumerate}
\item Require HTTPS
\item Store pepper in environment variables
\item Enable audit logging
\item Monitor attack patterns
\item Keep dependencies updated
\end{enumerate}

\subsection{For End Users}
\begin{enumerate}
\item Use unique, strong passwords
\item Enable MFA everywhere
\item Prefer hardware security keys
\item Verify URLs before credentials
\item Be wary of phishing
\end{enumerate}

\section{Conclusion}

This project comprehensively explored authentication security. Key findings:

\begin{enumerate}
\item \textbf{Password Hashing}: Argon2 best (memory-hard); SHA-256/SHA-3 too fast
\item \textbf{Salt \& Pepper}: Critical for rainbow table prevention
\item \textbf{Timing Attacks}: Constant-time eliminates side-channel
\item \textbf{MFA}: WebAuthn prevents relay; TOTP vulnerable
\item \textbf{MITM}: OTP relayable (30ms latency); WebAuthn blocks via origin binding
\end{enumerate}

\textbf{Lessons}: Security is layered; standards matter; defenses must evolve; user education essential.

\textbf{Future Work}: Hardware keys; biometrics; risk-based auth; session management; audit dashboard.

\section{References}

\begin{enumerate}[label={[\arabic*]}]
\item RFC 6238: TOTP Algorithm
\item RFC 4226: HOTP Algorithm
\item RFC 2104: HMAC
\item W3C WebAuthn Specification
\item FIDO2 Specifications
\item Argon2: Memory-hard password hashing
\item NIST SP 800-63B: Digital Identity Guidelines
\item OWASP Password Storage Cheat Sheet
\item OWASP Authentication Cheat Sheet
\end{enumerate}

\appendix
\section{Appendix}

\subsection{Code}
Complete source in Deliverables/Code with README.md and launcher.py

\subsection{Artifacts}
All in Deliverables/Artifacts/:
\begin{itemize}
\item QR codes: qr\_*.png
\item Statistics: *\_stats.json
\item Logs: mitm\_logs.json, timing\_attack\_results.txt
\item Screenshots: *.jpg
\end{itemize}

\subsection{Quick Start}
\begin{lstlisting}[language=bash]
cd Deliverables/Code
python3 launcher.py
# Select option 1 for Quick Demo
\end{lstlisting}

\end{document}
